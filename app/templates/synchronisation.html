{% extends "base.html" %}

{% block title %}Suivi des synchronisations{% endblock %}

{% block content %}
  <h2>ğŸ“¡ Suivi des synchronisations</h2>

  <p id="status-connexion">Ã‰tat de la connexion : <strong>...</strong></p>

  <h3>ğŸ•“ DonnÃ©es en attente de synchronisation</h3>
  <p><small>â„¹ï¸ L = donnÃ©es locales, S = donnÃ©es serveur</small></p>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Nom</th>
        <th>Quartier</th>
        <th>Date dâ€™enregistrement</th>
      </tr>
    </thead>
    <tbody id="pending-table">
      <tr><td colspan="4">Chargement...</td></tr>
    </tbody>
  </table>

  <button id="forceSyncBtn" class="btn btn-warning">ğŸ” Forcer la synchronisation</button>
  <div id="sync-message" class="mt-2 text-info"></div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  fetch("/api/pending-records")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#pending-table");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4">âœ… Aucune donnÃ©e en attente</td></tr>`;
        return;
      }

      data.forEach((famille, index) => {
        tbody.innerHTML += `
          <tr>
            <td>${index + 1}</td>
            <td>${famille.name || ""}</td>
            <td>${famille.city || ""}</td>
            <td>${famille.created_at || ""}</td>
          </tr>
        `;
      });
    })
    .catch(err => {
      console.error("Erreur de chargement", err);
      const tbody = document.querySelector("#pending-table");
      tbody.innerHTML = `<tr><td colspan="4">âŒ Erreur de chargement des donnÃ©es</td></tr>`;
    });
});
</script>

<script src="/static/js/sync-status.js"></script>
{% endblock %}
